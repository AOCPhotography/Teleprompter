<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Teleprompter</title>
  <style>
    body {
      background-color: black;
      color: white;
      margin: 0;
      font-size: 48px;
      font-family: Arial, sans-serif;
      overflow-y: scroll;
    }
    #controls {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(0,0,0,0.85);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      padding: 4px;
      z-index: 9999;
    }
    button, label {
      font-size: 14px;
      padding: 4px 8px;
      background-color: #333;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      margin: 2px;
    }
    button:hover, label:hover {
      background-color: #555;
    }
    input[type="range"] {
      width: 100px;
      margin: 0 10px;
    }
    #script {
      padding: 120px 80px 60px 80px;
      max-width: 1000px;
      margin: auto;
      white-space: pre-wrap;
      outline: none;
      transform: scaleX(-1);
    }
    .highlight-grey {
      background-color: grey;
      color: black;
    }
  </style>
</head>
<body>
  <div id="controls">
    <button onclick="saveScript()">💾</button>
    <label>
      📂<input type="file" id="fileInput" style="display: none" />
    </label>
    <button onclick="toggleEdit()">✏️</button>
    <button onclick="toggleMirror()">🔁</button>
    <button onclick="highlightSelection('grey')">🟨</button>
    <button onclick="removeHighlight()">❌</button>
    <button onclick="skipToNextHighlight()">⏩</button>
    <label>🔄<input type="range" id="speedSlider" min="1" max="20" value="2" /></label>
    <label>🔠<input type="range" id="fontSizeSlider" min="12" max="200" value="48" /></label>
    <button onclick="togglePlay()">▶️/⏸️</button>
    <button onclick="toggleFullscreen()">⛶</button>
  </div>

  <div id="script" contenteditable="true">Paste your teleprompter script here...</div>

  <script>
    const script = document.getElementById("script");
    const speedSlider = document.getElementById("speedSlider");
    const fontSlider = document.getElementById("fontSizeSlider");
    const fileInput = document.getElementById("fileInput");
    let isPlaying = false;
    let scrollSpeed = parseFloat(speedSlider.value);
    let fontSize = parseInt(fontSlider.value);
    let scrollInterval;

    function togglePlay() {
      isPlaying = !isPlaying;
      if (isPlaying) {
        scrollInterval = setInterval(() => {
          window.scrollBy(0, scrollSpeed);
        }, 16);
      } else {
        clearInterval(scrollInterval);
      }
    }

    function toggleFullscreen() {
      const isFull = !!document.fullscreenElement;
      if (!isFull) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }

    function toggleEdit() {
      script.contentEditable = script.isContentEditable ? "false" : "true";
    }

    function toggleMirror() {
      script.style.transform = script.style.transform === "scaleX(-1)" ? "scaleX(1)" : "scaleX(-1)";
    }

    function highlightSelection(color) {
      const selection = window.getSelection();
      if (!selection.rangeCount) return;
      const range = selection.getRangeAt(0);
      const span = document.createElement("span");
      span.className = `highlight-${color}`;
      range.surroundContents(span);
    }

    function removeHighlight() {
      document.querySelectorAll("span[class^='highlight']").forEach(el => {
        const parent = el.parentNode;
        parent.replaceChild(document.createTextNode(el.textContent), el);
        parent.normalize();
      });
    }

    function skipToNextHighlight() {
      const highlights = document.querySelectorAll("span[class^='highlight']");
      const scrollY = window.scrollY;
      for (let el of highlights) {
        const offset = el.getBoundingClientRect().top + scrollY;
        if (offset > scrollY + 10) {
          window.scrollTo({ top: offset - 100, behavior: "smooth" });
          break;
        }
      }
    }

    function saveScript() {
      const blob = new Blob([script.innerHTML], { type: "text/html" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "teleprompter-script.html";
      a.click();
    }

    speedSlider.addEventListener("input", (e) => {
      scrollSpeed = parseFloat(e.target.value);
    });

    fontSlider.addEventListener("input", (e) => {
      fontSize = parseInt(e.target.value);
      script.style.fontSize = fontSize + "px";
    });

    document.addEventListener("keydown", (e) => {
      if (e.ctrlKey && e.shiftKey && e.key === "1") {
        scrollSpeed = Math.max(1, scrollSpeed - 1);
        speedSlider.value = scrollSpeed;
      }
      if (e.ctrlKey && e.shiftKey && e.key === "2") {
        scrollSpeed++;
        speedSlider.value = scrollSpeed;
      }
      if (e.ctrlKey && e.shiftKey && e.key === "4") {
        fontSize = Math.max(12, fontSize - 4);
        fontSlider.value = fontSize;
        script.style.fontSize = fontSize + "px";
      }
      if (e.ctrlKey && e.shiftKey && e.key === "5") {
        fontSize = Math.min(200, fontSize + 4);
        fontSlider.value = fontSize;
        script.style.fontSize = fontSize + "px";
      }
    });

    fileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (event) => {
        script.innerText = event.target.result;
      };
      reader.readAsText(file);
    });

    // Restore from localStorage
    window.addEventListener("load", () => {
      const saved = localStorage.getItem("teleprompter-script");
      if (saved) script.innerHTML = saved;
    });

    // Save to localStorage on change
    script.addEventListener("input", () => {
      localStorage.setItem("teleprompter-script", script.innerHTML);
    });
  </script>
</body>
</html>
